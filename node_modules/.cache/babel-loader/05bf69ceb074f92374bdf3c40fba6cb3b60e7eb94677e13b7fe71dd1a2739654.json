{"ast":null,"code":"import _slicedToArray from\"/Users/syedabbasali/Desktop/IndividualProject/submission/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";var logoutTimer;var AuthContext=/*#__PURE__*/React.createContext({token:'',isLoggedIn:false,login:function login(token){},logout:function logout(){}});var calculateRemainingTime=function calculateRemainingTime(expirationTime){var currentTime=new Date().getTime();var adjExpirationTime=new Date(expirationTime).getTime();var remainingDuration=adjExpirationTime-currentTime;return remainingDuration;};var retrieveStoredToken=function retrieveStoredToken(){var storedToken=localStorage.getItem('token');var storedExpirationDate=localStorage.getItem('expirationTime');var remainingTime=calculateRemainingTime(storedExpirationDate);if(remainingTime<=3600){localStorage.removeItem('token');localStorage.removeItem('expirationTime');return null;}return{token:storedToken,duration:remainingTime};};export var AuthContextProvider=function AuthContextProvider(props){var tokenData=retrieveStoredToken();var initialToken;if(tokenData){initialToken=tokenData.token;}var _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var userIsLoggedIn=!!token;var logoutHandler=useCallback(function(){setToken(null);localStorage.removeItem('token');localStorage.removeItem('expirationTime');if(logoutTimer){clearTimeout(logoutTimer);}},[]);var loginHandler=function loginHandler(token,expirationTime){setToken(token);localStorage.setItem('token',token);localStorage.setItem('expirationTime',expirationTime);var remainingTime=calculateRemainingTime(expirationTime);logoutTimer=setTimeout(logoutHandler,remainingTime);};useEffect(function(){if(tokenData){console.log(tokenData.duration);logoutTimer=setTimeout(logoutHandler,tokenData.duration);}},[tokenData,logoutHandler]);var contextValue={token:token,isLoggedIn:userIsLoggedIn,login:loginHandler,logout:logoutHandler};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:props.children});};export default AuthContext;","map":{"version":3,"names":["React","useState","useEffect","useCallback","logoutTimer","AuthContext","createContext","token","isLoggedIn","login","logout","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","userIsLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","console","log","contextValue","children"],"sources":["/Users/syedabbasali/Desktop/IndividualProject/submission/FrontendV3/src/store/auth-context.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\n\nlet logoutTimer;\n\nconst AuthContext = React.createContext({\n  token: '',\n  isLoggedIn: false,\n  login: (token) => {},\n  logout: () => {},\n});\n\nconst calculateRemainingTime = (expirationTime) => {\n  const currentTime = new Date().getTime();\n  const adjExpirationTime = new Date(expirationTime).getTime();\n\n  const remainingDuration = adjExpirationTime - currentTime;\n\n  return remainingDuration;\n};\n\nconst retrieveStoredToken = () => {\n  const storedToken = localStorage.getItem('token');\n  const storedExpirationDate = localStorage.getItem('expirationTime');\n\n  const remainingTime = calculateRemainingTime(storedExpirationDate);\n\n  if (remainingTime <= 3600) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('expirationTime');\n    return null;\n  }\n\n  return {\n    token: storedToken,\n    duration: remainingTime,\n  };\n};\n\nexport const AuthContextProvider = (props) => {\n  const tokenData = retrieveStoredToken();\n  \n  let initialToken;\n  if (tokenData) {\n    initialToken = tokenData.token;\n  }\n\n  const [token, setToken] = useState(initialToken);\n\n  const userIsLoggedIn = !!token;\n\n  const logoutHandler = useCallback(() => {\n    setToken(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('expirationTime');\n\n    if (logoutTimer) {\n      clearTimeout(logoutTimer);\n    }\n  }, []);\n\n  const loginHandler = (token, expirationTime) => {\n    setToken(token);\n    localStorage.setItem('token', token);\n    localStorage.setItem('expirationTime', expirationTime);\n\n    const remainingTime = calculateRemainingTime(expirationTime);\n\n    logoutTimer = setTimeout(logoutHandler, remainingTime);\n  };\n\n  useEffect(() => {\n    if (tokenData) {\n      console.log(tokenData.duration);\n      logoutTimer = setTimeout(logoutHandler, tokenData.duration);\n    }\n  }, [tokenData, logoutHandler]);\n\n  const contextValue = {\n    token: token,\n    isLoggedIn: userIsLoggedIn,\n    login: loginHandler,\n    logout: logoutHandler,\n  };\n\n  return (\n    <AuthContext.Provider value={contextValue}>\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}